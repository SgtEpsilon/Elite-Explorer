<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Elite Explorer ‚Äî Live</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Orbitron:wght@400;500;700&family=Exo+2:wght@200;300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="topbar">
  <span class="tb-logo">&#9672; Explorer</span>
  <div class="tb-sep"></div>
  <span class="tb-cmdr" id="tb-cmdr">&#8212;</span>
  <div class="tb-sep"></div>
  <span class="tb-sys" id="tb-sys">&#8212;</span><span id="tb-discovery-star" title="First Discovery!" style="display:none;color:var(--gold);margin-left:4px;font-size:0.85em;">&#9733;</span>
  <div class="tab-nav">
    <a class="tab-btn active" href="index.html">Live</a>
    <a class="tab-btn" href="profile.html">Profile</a>
    <a class="tab-btn" href="history.html">History</a>
	<a class="tab-btn" href="spansh.html">Spansh</a>
  </div>
  <span class="tb-credits" id="tb-credits"></span>
  <span id="eddn-dot" title="EDDN: disabled" style="width:6px;height:6px;border-radius:50%;background:var(--border2);display:inline-block;margin-right:4px;transition:background 0.4s;"></span>
  <span id="edsm-dot" title="EDSM: disabled" style="width:6px;height:6px;border-radius:50%;background:var(--border2);display:inline-block;margin-right:8px;transition:background 0.4s;"></span>
  <button id="options-btn" title="Options">&#9881;</button>
</div>

<div id="app-wrapper" style="display:flex;flex-direction:column;height:calc(100vh - 44px);">

  <div id="view-live" class="active">

    <!-- LEFT COLUMN: Commander (scrollable) + Scan Summary (locked bottom) -->
    <div class="live-col" id="live-col-left">

      <div class="panel" id="panel-commander">
        <div class="panel-header">
          <span class="label">Commander</span>
          <div class="accent-line"></div>
        </div>
        <div class="panel-body">
          <div class="stat-group">
            <div class="stat-group-title">Navigation</div>
            <div class="stat-row"><span class="stat-key">System</span><span class="stat-val highlight" id="sys-name">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Pos</span><span class="stat-val" id="sys-pos" style="font-size:0.75em">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Security</span><span class="stat-val" id="sys-security" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Allegiance</span><span class="stat-val" id="sys-allegiance" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Economy</span><span class="stat-val" id="sys-economy" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Population</span><span class="stat-val" id="sys-population" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row">
              <span class="stat-key">EDSM</span>
              <a id="edsm-link" href="#" title="View on Elite Dangerous Star Map"
                 style="font-size:0.75em;color:var(--cyan);text-decoration:none;font-family:var(--mono);cursor:pointer;opacity:0.5;pointer-events:none;"
                 onclick="return false;">&#8599; View system</a>
            </div>
          </div>
          <div class="stat-group">
            <div class="stat-group-title">Ship Status</div>
            <div class="stat-row"><span class="stat-key">Name</span><span class="stat-val" id="ship-name" style="font-size:0.75em">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Type</span><span class="stat-val" id="ship-type" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Ident</span><span class="stat-val" id="ship-ident" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Jump Range</span><span class="stat-val highlight" id="ship-range">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Cargo Cap</span><span class="stat-val" id="ship-cargo">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Fuel</span><span class="stat-val" id="ship-fuel">&#8212;</span></div>
            <div class="fuel-bar-wrap"><div class="fuel-bar-fill" id="fuel-bar" style="width:0%"></div></div>
            <div class="stat-row" style="margin-top:4px;"><span class="stat-key">Hull</span><span class="stat-val green" id="ship-hull">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Rebuy</span><span class="stat-val red" id="ship-rebuy">&#8212;</span></div>
          </div>
          <div class="stat-group">
            <div class="stat-group-title">Station</div>
            <div class="stat-row"><span class="stat-key">Name</span><span class="stat-val" id="station-name" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Type</span><span class="stat-val" id="station-type" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Faction</span><span class="stat-val" id="station-faction" style="font-size:0.75em;color:var(--text-dim)">&#8212;</span></div>
            <div class="stat-row"><span class="stat-key">Credits</span><span class="stat-val gold" id="credits">&#8212;</span></div>
          </div>
        </div>
      </div>

      <div class="panel" id="panel-summary">
        <div class="panel-header">
          <span class="label">Scan Summary</span>
          <div class="accent-line"></div>
        </div>
        <div class="panel-body">
          <div class="summary-grid">
            <div><div class="summary-num" id="sum-stars">0</div><div class="summary-lbl">Stars</div></div>
            <div><div class="summary-num" id="sum-planets">0</div><div class="summary-lbl">Planets</div></div>
            <div><div class="summary-num" id="sum-moons">0</div><div class="summary-lbl">Moons</div></div>
            <div><div class="summary-num" id="sum-total">0</div><div class="summary-lbl">Total</div></div>
          </div>
        </div>
      </div>

    </div><!-- /live-col-left -->

    <!-- MIDDLE COLUMN: System Bodies (scrollable) + Journal Scan (locked bottom) + Log spacer -->
    <div class="live-col" id="live-col-mid">

      <div class="panel" id="panel-system">
        <div class="panel-header">
          <span class="label">System Bodies</span>
          <div class="accent-line"></div>
          <span style="font-family:var(--mono);font-size:0.75em;color:var(--text-mute)" id="body-count">0 bodies</span>
        </div>
        <div class="panel-body" style="padding:0;">
          <table class="bodies-table">
            <thead>
              <tr>
                <th style="width:28px"></th>
                <th>Name</th>
                <th>Class</th>
                <th>Distance</th>
                <th>Information</th>
                <th style="text-align:right">Value</th>
                <th style="text-align:right">Max</th>
              </tr>
            </thead>
            <tbody id="bodies-tbody">
              <tr><td colspan="7"><div class="empty-state"><div class="icon">&#9678;</div><div class="msg">Awaiting scan data</div></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="panel-progress">
        <div class="panel-header" style="padding:6px 10px;">
          <span class="label">Journal Scan</span><div class="accent-line"></div>
          <span style="font-family:var(--mono);font-size:0.75em;color:var(--text-mute)" id="progress-pct">&#8212;</span>
          <span style="font-family:var(--mono);font-size:0.7em;color:var(--text-mute);margin-left:6px;" id="progress-info">Ready</span>
        </div>
        <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>
        <div id="progress-detail" style="display:none;"></div>
      </div>

      <div class="col-log-spacer"></div>

    </div><!-- /live-col-mid -->

    <!-- RIGHT COLUMN: Scan Values (scrollable) + Application Log (locked bottom) -->
    <div class="live-col" id="live-col-right">

      <div class="panel" id="panel-scan">
        <div class="panel-header"><span class="label">Scan Values</span><div class="accent-line"></div></div>
        <div class="scan-total-bar"><span class="scan-total-label">EST. TOTAL</span><span class="scan-total-val" id="scan-total">0 cr</span></div>
        <div class="panel-body" style="padding:0;">
          <table class="scan-table">
            <thead>
              <tr>
                <th>Body</th>
                <th>Type</th>
                <th style="text-align:center">Mapped</th>
                <th style="text-align:right">Value</th>
              </tr>
            </thead>
            <tbody id="scan-tbody">
              <tr><td colspan="4"><div class="empty-state" style="height:60px;"><div class="msg">No scans yet</div></div></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel" id="panel-log">
        <div class="panel-header">
          <span class="label">Application Log</span>
          <div class="accent-line"></div>
          <span id="log-count" style="font-family:var(--mono);font-size:0.75em;color:var(--text-mute)">0 entries</span>
        </div>
        <div id="log-entries"></div>
      </div>

    </div><!-- /live-col-right -->

  </div><!-- /view-live -->

</div><!-- /app-wrapper -->

<!-- OPTIONS PANEL -->
<div id="options-overlay"></div>
<div id="options-panel">
  <div id="options-header">
    <span style="font-family:var(--display);font-size:0.75em;letter-spacing:0.25em;color:var(--gold)">OPTIONS</span>
    <button id="options-close">&#10005;</button>
  </div>
  <div id="options-body">
    <div class="opt-section">
      <div class="opt-section-title">Journal Scan</div>
      <button class="opt-action-btn" id="opt-scan-btn">
        <span class="opt-btn-icon">&#11041;</span>
        <div><div class="opt-btn-label">Scan All Journals</div><div class="opt-btn-sub">Re-process all Elite journal files</div></div>
      </button>
    </div>
    <div class="opt-section">
      <div class="opt-section-title">EDDN ‚Äî Data Network</div>
      <label class="opt-toggle" style="margin-bottom:8px;">
        <input type="checkbox" id="opt-eddn-enabled">
        <span class="tog-track"><span class="tog-thumb"></span></span>
        <span class="tog-lbl">Submit events to EDDN</span>
      </label>
      <div class="opt-hint">Shares jump, scan &amp; dock events with the community network. Your commander name is used as the uploader ID.</div>
      <div style="margin-top:8px;">
        <label style="font-size:0.72em;color:var(--text-dim);display:block;margin-bottom:3px;">Commander Name (uploader ID)</label>
        <input class="opt-input" id="opt-cmdr-name" type="text" placeholder="Your in-game commander name" spellcheck="false"/>
      </div>
    </div>
    <div class="opt-section">
      <div class="opt-section-title">EDSM ‚Äî Star Map</div>
      <label class="opt-toggle" style="margin-bottom:8px;">
        <input type="checkbox" id="opt-edsm-enabled">
        <span class="tog-track"><span class="tog-thumb"></span></span>
        <span class="tog-lbl">Fetch system data from EDSM</span>
      </label>
      <div class="opt-hint">Displays security, allegiance, population and enables the EDSM link for each system you visit. No account required for lookups.</div>
      <div style="margin-top:8px;">
        <label style="font-size:0.72em;color:var(--text-dim);display:block;margin-bottom:3px;">EDSM Commander Name <span style="opacity:0.5">(optional ‚Äî for flight log sync)</span></label>
        <input class="opt-input" id="opt-edsm-cmdr" type="text" placeholder="Your EDSM commander name" spellcheck="false"/>
      </div>
      <div style="margin-top:6px;">
        <label style="font-size:0.72em;color:var(--text-dim);display:block;margin-bottom:3px;">EDSM API Key <span style="opacity:0.5">(optional ‚Äî from edsm.net/en/settings/api)</span></label>
        <input class="opt-input" id="opt-edsm-key" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" spellcheck="false"/>
      </div>
      <button class="opt-action-btn" id="opt-save-api-btn" style="margin-top:10px;">
        <span class="opt-btn-icon">&#10003;</span>
        <div><div class="opt-btn-label">Save API Settings</div><div class="opt-btn-sub" id="opt-api-hint">Changes take effect immediately</div></div>
      </button>
    </div>
    <div class="opt-section">
      <div class="opt-section-title">Journal Folder</div>
      <div class="opt-path-row">
        <input class="opt-input" id="opt-journal-path" type="text" placeholder="Auto-detected" spellcheck="false"/>
        <button class="opt-icon-btn" id="opt-browse-btn" title="Browse">&#9645;</button>
        <button class="opt-icon-btn" id="opt-open-btn" title="Open in Explorer">&#8599;</button>
      </div>
      <div class="opt-hint" id="opt-path-hint">Leave blank to use the default path for your OS</div>
    </div>
    <div class="opt-section">
      <div class="opt-section-title">Theme</div>
      <div class="opt-theme-grid">
        <div class="opt-theme-swatch active" data-theme="default"><div class="swatch-bar" style="background:#c8972a"></div><div class="swatch-bar" style="background:#2ecfcf"></div><span>Default</span></div>
        <div class="opt-theme-swatch" data-theme="red"><div class="swatch-bar" style="background:#e05252"></div><div class="swatch-bar" style="background:#cf7a3e"></div><span>Red Alert</span></div>
        <div class="opt-theme-swatch" data-theme="green"><div class="swatch-bar" style="background:#4caf7d"></div><div class="swatch-bar" style="background:#a0cf3e"></div><span>Viridian</span></div>
        <div class="opt-theme-swatch" data-theme="purple"><div class="swatch-bar" style="background:#a855f7"></div><div class="swatch-bar" style="background:#cf3ecf"></div><span>Nebula</span></div>
      </div>
    </div>
    <div class="opt-section">
      <div class="sl-group">
        <div class="sl-group-title">Scale &amp; Size</div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">UI Scale</span><span class="sl-val" id="sv-scale">100%</span></div><input type="range" class="sl-input" id="sl-scale" min="70" max="130" step="1" value="100"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Font Size</span><span class="sl-val" id="sv-font">24px</span></div><input type="range" class="sl-input" id="sl-font" min="1" max="32" step="0.5" value="24"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Row Density</span><span class="sl-val" id="sv-density">Normal</span></div><input type="range" class="sl-input" id="sl-density" min="1" max="5" step="1" value="3"></div>
      </div>
      <div class="sl-group">
        <div class="sl-group-title">Panel Layout</div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Left Panel Width</span><span class="sl-val" id="sv-left">250px</span></div><input type="range" class="sl-input" id="sl-left" min="1" max="360" step="5" value="250"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Right Panel Width</span><span class="sl-val" id="sv-right">320px</span></div><input type="range" class="sl-input" id="sl-right" min="1" max="500" step="5" value="320"></div>
      </div>
      <div class="sl-group">
        <div class="sl-group-title">Atmosphere</div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Brightness</span><span class="sl-val" id="sv-bright">100%</span></div><input type="range" class="sl-input" id="sl-bright" min="40" max="160" step="2" value="100"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Panel Opacity</span><span class="sl-val" id="sv-opacity">100%</span></div><input type="range" class="sl-input" id="sl-opacity" min="30" max="100" step="2" value="100"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Scanlines</span><span class="sl-val" id="sv-scan">Low</span></div><input type="range" class="sl-input" id="sl-scan" min="0" max="5" step="1" value="1"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Glow Intensity</span><span class="sl-val" id="sv-glow">100%</span></div><input type="range" class="sl-input" id="sl-glow" min="0" max="200" step="5" value="100"></div>
        <div class="sl-row"><div class="sl-header"><span class="sl-label">Border Sharpness</span><span class="sl-val" id="sv-border">Medium</span></div><input type="range" class="sl-input" id="sl-border" min="0" max="4" step="1" value="2"></div>
      </div>
      <button class="sl-reset" id="sl-reset-all">&#8635; Reset All Display Settings</button>
    </div>
    <div class="opt-section">
      <div class="opt-section-title">Toggle Panels</div>
      <div class="opt-toggles">
        <label class="opt-toggle"><input type="checkbox" id="tog-commander" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">Commander</span></label>
        <label class="opt-toggle"><input type="checkbox" id="tog-system" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">System Bodies</span></label>
        <label class="opt-toggle"><input type="checkbox" id="tog-scan" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">Scan Values</span></label>
        <label class="opt-toggle"><input type="checkbox" id="tog-summary" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">Scan Summary</span></label>
        <label class="opt-toggle"><input type="checkbox" id="tog-progress" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">Journal Progress</span></label>
        <label class="opt-toggle"><input type="checkbox" id="tog-log" checked><span class="tog-track"><span class="tog-thumb"></span></span><span class="tog-lbl">Application Log</span></label>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     UPDATE AVAILABLE MODAL
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="update-overlay" style="
  display:none;position:fixed;inset:0;z-index:9990;
  background:rgba(0,0,0,0.65);backdrop-filter:blur(3px);
  align-items:center;justify-content:center;
"></div>

<div id="update-modal" style="
  display:none;position:fixed;z-index:9999;
  top:50%;left:50%;transform:translate(-50%,-50%);
  width:420px;max-width:calc(100vw - 32px);
  background:linear-gradient(160deg,#0b1a30 0%,#091220 100%);
  border:1px solid #1e3f6a;border-radius:14px;
  padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.8),0 0 0 1px rgba(100,180,255,0.06);
  font-family:inherit;color:#c8d8f0;font-size:0.88em;box-sizing:border-box;
">
  <!-- Header -->
  <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;">
    <div style="display:flex;align-items:center;gap:10px;">
      <div id="um-icon" style="font-size:2em;line-height:1;">üöÄ</div>
      <div>
        <div id="um-title" style="font-weight:700;color:#7eb8f7;font-size:1.15em;line-height:1.2;"></div>
        <div id="um-channel-badge" style="
          display:inline-block;margin-top:4px;padding:2px 8px;border-radius:20px;font-size:0.78em;font-weight:600;
          background:#1a3a1a;color:#4caf82;border:1px solid #2a5a2a;
        "></div>
      </div>
    </div>
    <button id="um-close" style="
      background:none;border:none;color:#3a5a7a;cursor:pointer;
      font-size:1.3em;padding:0 0 0 8px;line-height:1;flex-shrink:0;
    " title="Dismiss">‚úï</button>
  </div>

  <!-- Body -->
  <div id="um-body" style="color:#8fa8c8;line-height:1.6;margin-bottom:14px;"></div>

  <!-- Release notes -->
  <div id="um-notes-wrap" style="display:none;margin-bottom:14px;">
    <div style="font-size:0.82em;color:#4a6a8a;margin-bottom:5px;text-transform:uppercase;letter-spacing:.06em;">What's new</div>
    <div id="um-notes" style="
      background:#060f1e;border:1px solid #1a3050;border-radius:8px;
      padding:10px 12px;max-height:100px;overflow-y:auto;
      color:#6a8aaa;font-size:0.9em;line-height:1.55;
    "></div>
  </div>

  <!-- Progress -->
  <div id="um-progress-wrap" style="display:none;margin-bottom:14px;">
    <div style="background:#0d1f35;border-radius:4px;height:6px;overflow:hidden;">
      <div id="um-progress-bar" style="
        height:100%;width:0%;
        background:linear-gradient(90deg,#1a4a8f,#7eb8f7);
        transition:width 0.25s;
      "></div>
    </div>
    <div id="um-progress-lbl" style="margin-top:6px;font-size:0.85em;color:#4a6a8a;"></div>
  </div>

  <!-- Actions -->
  <div id="um-actions" style="display:flex;flex-direction:column;gap:8px;"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PREFERENCES MODAL
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="prefs-overlay" style="
  display:none;position:fixed;inset:0;z-index:9980;
  background:rgba(0,0,0,0.65);backdrop-filter:blur(3px);
"></div>

<div id="prefs-modal" style="
  display:none;position:fixed;z-index:9989;
  top:50%;left:50%;transform:translate(-50%,-50%);
  width:440px;max-width:calc(100vw - 32px);
  background:linear-gradient(160deg,#0b1a30 0%,#091220 100%);
  border:1px solid #1e3f6a;border-radius:14px;
  padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.8),0 0 0 1px rgba(100,180,255,0.06);
  font-family:inherit;color:#c8d8f0;font-size:0.88em;box-sizing:border-box;
">
  <!-- Header -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <div style="display:flex;align-items:center;gap:10px;">
      <span style="font-size:1.4em;">‚öôÔ∏è</span>
      <span style="font-weight:700;color:#7eb8f7;font-size:1.1em;">Preferences</span>
    </div>
    <button id="prefs-close" style="
      background:none;border:none;color:#3a5a7a;cursor:pointer;font-size:1.3em;padding:0;line-height:1;
    " title="Close">‚úï</button>
  </div>

  <!-- Section: Updates -->
  <div style="margin-bottom:20px;">
    <div style="
      font-size:0.78em;font-weight:600;text-transform:uppercase;letter-spacing:.08em;
      color:#4a6a8a;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #0e2040;
    ">Software Updates</div>

    <!-- Channel selector -->
    <div style="margin-bottom:14px;">
      <div style="font-weight:600;color:#a0c0e8;margin-bottom:4px;">Update Channel</div>
      <div style="color:#5a7a9a;font-size:0.88em;margin-bottom:10px;line-height:1.5;">
        Choose whether you want stable releases or early access to new features.
      </div>

      <div style="display:flex;flex-direction:column;gap:8px;">
        <!-- Stable option -->
        <label id="pref-ch-stable-label" style="
          display:flex;align-items:flex-start;gap:12px;padding:10px 12px;
          border-radius:8px;border:2px solid #1e3f6a;cursor:pointer;
          background:#060f1e;transition:border-color .15s;
        ">
          <input type="radio" name="update-channel" value="stable" id="pref-ch-stable" style="margin-top:2px;accent-color:#7eb8f7;">
          <div>
            <div style="font-weight:600;color:#c8d8f0;display:flex;align-items:center;gap:6px;">
              üõ°Ô∏è Stable
              <span style="
                font-size:0.72em;padding:2px 7px;border-radius:20px;font-weight:600;
                background:#1a2a1a;color:#4caf82;border:1px solid #2a4a2a;
              ">Recommended</span>
            </div>
            <div style="font-size:0.85em;color:#5a7a9a;margin-top:2px;line-height:1.4;">
              Tracks the <code style="color:#7eb8f7;background:#0a1830;padding:1px 4px;border-radius:3px;">main</code> branch. Tested, reliable builds only.
            </div>
          </div>
        </label>

        <!-- Alpha/Beta option -->
        <label id="pref-ch-beta-label" style="
          display:flex;align-items:flex-start;gap:12px;padding:10px 12px;
          border-radius:8px;border:2px solid #1e3f6a;cursor:pointer;
          background:#060f1e;transition:border-color .15s;
        ">
          <input type="radio" name="update-channel" value="beta" id="pref-ch-beta" style="margin-top:2px;accent-color:#f0a030;">
          <div>
            <div style="font-weight:600;color:#c8d8f0;display:flex;align-items:center;gap:6px;">
              üß™ Alpha / Beta
              <span style="
                font-size:0.72em;padding:2px 7px;border-radius:20px;font-weight:600;
                background:#2a1a0a;color:#f0a030;border:1px solid #4a3010;
              ">Early Access</span>
            </div>
            <div style="font-size:0.85em;color:#5a7a9a;margin-top:2px;line-height:1.4;">
              Tracks the <code style="color:#f0a030;background:#0a1830;padding:1px 4px;border-radius:3px;">development</code> branch. New features, may be unstable.
            </div>
          </div>
        </label>
      </div>
    </div>

    <!-- Status line -->
    <div id="pref-channel-status" style="
      font-size:0.82em;color:#4a6a8a;min-height:1.4em;margin-top:2px;
    "></div>
  </div>

  <!-- Section: Debug Log -->
  <div style="margin-bottom:20px;">
    <div style="
      font-size:0.78em;font-weight:600;text-transform:uppercase;letter-spacing:.08em;
      color:#4a6a8a;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #0e2040;
    ">Debug &amp; Bug Reports</div>
    <div style="color:#5a7a9a;font-size:0.88em;margin-bottom:12px;line-height:1.5;">
      Save a debug log file and attach it when filing a bug report on GitHub. It includes
      recent application events but <strong style="color:#a0b8d0;">no personal game data</strong>.
    </div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <button id="prefs-save-log" style="
        padding:7px 16px;border-radius:6px;cursor:pointer;font-size:0.88em;font-weight:600;
        background:#0d1f35;color:#7eb8f7;border:1px solid #1e3a5f;
        display:flex;align-items:center;gap:6px;
      ">üìÑ Save Debug Log‚Ä¶</button>
      <button id="prefs-view-log" style="
        padding:7px 16px;border-radius:6px;cursor:pointer;font-size:0.88em;font-weight:600;
        background:#0d1f35;color:#5a9abf;border:1px solid #1a3050;
        display:flex;align-items:center;gap:6px;
      ">üîç Preview Log</button>
    </div>
    <div id="prefs-log-status" style="font-size:0.82em;color:#4a6a8a;min-height:1.4em;margin-top:8px;"></div>
    <!-- Inline log preview -->
    <div id="prefs-log-preview" style="
      display:none;margin-top:10px;max-height:180px;overflow-y:auto;
      background:#040b14;border:1px solid #0e2040;border-radius:6px;
      padding:8px 10px;font-family:'Share Tech Mono',monospace;font-size:0.75em;
      color:#5a8aaa;white-space:pre;line-height:1.5;
    "></div>
  </div>

  <!-- Footer -->
  <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:4px;">
    <button id="prefs-check-now" style="
      padding:7px 16px;border-radius:6px;cursor:pointer;font-size:0.88em;font-weight:600;
      background:#0d1f35;color:#7eb8f7;border:1px solid #1e3a5f;
    ">Check for Updates</button>
    <button id="prefs-done" style="
      padding:7px 18px;border-radius:6px;cursor:pointer;font-size:0.88em;font-weight:600;
      background:#1a4a8f;color:#d0e8ff;border:1px solid #2a6abf;
    ">Done</button>
  </div>
</div>

<script>
(function () {
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // UPDATE MODAL
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const overlay    = document.getElementById('update-overlay');
  const modal      = document.getElementById('update-modal');
  const umIcon     = document.getElementById('um-icon');
  const umTitle    = document.getElementById('um-title');
  const umBadge    = document.getElementById('um-channel-badge');
  const umBody     = document.getElementById('um-body');
  const umNotesW   = document.getElementById('um-notes-wrap');
  const umNotes    = document.getElementById('um-notes');
  const umProgW    = document.getElementById('um-progress-wrap');
  const umProgBar  = document.getElementById('um-progress-bar');
  const umProgLbl  = document.getElementById('um-progress-lbl');
  const umActions  = document.getElementById('um-actions');
  const umClose    = document.getElementById('um-close');

  let currentVersion = null;

  function showChannelBadge(channel) {
    if (channel === 'beta') {
      umBadge.textContent = 'üß™ Alpha / Beta channel';
      umBadge.style.background = '#2a1a0a';
      umBadge.style.color      = '#f0a030';
      umBadge.style.border     = '1px solid #4a3010';
    } else {
      umBadge.textContent = 'üõ°Ô∏è Stable channel';
      umBadge.style.background = '#1a3a1a';
      umBadge.style.color      = '#4caf82';
      umBadge.style.border     = '1px solid #2a5a2a';
    }
    umBadge.style.display = 'inline-block';
  }

  function openModal() {
    overlay.style.display = 'flex';
    modal.style.display   = 'block';
  }
  function closeModal() {
    overlay.style.display = 'none';
    modal.style.display   = 'none';
  }

  umClose.addEventListener('click', closeModal);
  overlay.addEventListener('click', closeModal);

  function makeBtn(label, style, onClick) {
    const b = document.createElement('button');
    b.textContent = label;
    const styles = {
      primary:   'background:#1a4a8f;color:#d0e8ff;border:1px solid #2a6abf;',
      secondary: 'background:#0d1f35;color:#7eb8f7;border:1px solid #1e3a5f;',
      ghost:     'background:transparent;color:#4a6a8a;border:1px solid transparent;',
    };
    b.style.cssText = `
      width:100%;padding:8px 12px;border-radius:7px;cursor:pointer;
      font-size:0.9em;font-weight:600;text-align:left;
      ${styles[style] || styles.secondary}
    `;
    b.addEventListener('click', onClick);
    return b;
  }

  function showUpdate(iconChar, titleText, bodyText, channel) {
    umIcon.textContent  = iconChar;
    umTitle.textContent = titleText;
    umBody.textContent  = bodyText;
    umActions.innerHTML = '';
    umNotesW.style.display  = 'none';
    umProgW.style.display   = 'none';
    showChannelBadge(channel || 'stable');
    openModal();
  }

  function showReleaseNotes(html) {
    if (!html) return;
    if (Array.isArray(html)) {
      html = html.map(r => (typeof r === 'object' ? (r.note || r.body || '') : r)).join('\n');
    }
    const decoder = document.createElement('textarea');
    decoder.innerHTML = String(html);
    let decoded = decoder.value;
    decoded = decoded.replace(/<[^>]+>/g, ' ');
    const text = decoded.replace(/\s+/g, ' ').trim();
    if (!text) return;
    umNotes.textContent    = text;
    umNotesW.style.display = 'block';
  }

  function lockButtons(message) {
    umActions.innerHTML = '';
    const p = document.createElement('div');
    p.style.cssText = 'color:#4a6a8a;font-size:0.88em;padding:4px 0;';
    p.textContent   = message;
    umActions.appendChild(p);
  }

  if (window.electronAPI && window.electronAPI.onUpdateStatus) {
    window.electronAPI.onUpdateStatus((data) => {
      switch (data.status) {

        case 'available': {
          currentVersion = data.version;
          showUpdate('üöÄ', `Update v${data.version} Available`,
            'A new version of Elite Explorer is ready. How would you like to proceed?',
            data.channel);
          showReleaseNotes(data.releaseNotes);

          umActions.appendChild(makeBtn('‚ö°  Download and update now', 'primary', () => {
            lockButtons('Downloading‚Ä¶');
            umProgW.style.display = 'block';
            window.electronAPI.downloadUpdateNow();
          }));
          umActions.appendChild(makeBtn('üïì  Download and update next launch', 'secondary', () => {
            lockButtons('Will download in the background and install on next launch.');
            umProgW.style.display = 'block';
            window.electronAPI.downloadUpdateOnQuit();
          }));
          umActions.appendChild(makeBtn('‚úï  Skip this version', 'ghost', () => {
            window.electronAPI.skipVersion(currentVersion);
            closeModal();
          }));
          break;
        }

        case 'downloading': {
          umIcon.textContent  = '‚¨áÔ∏è';
          umTitle.textContent = 'Downloading Update‚Ä¶';
          umProgW.style.display = 'block';
          umProgBar.style.width = data.percent + '%';
          const mb    = (data.transferred / 1048576).toFixed(1);
          const total = (data.total       / 1048576).toFixed(1);
          const kbps  = (data.bytesPerSecond / 1024).toFixed(0);
          umProgLbl.textContent = `${mb} / ${total} MB  ¬∑  ${kbps} KB/s  (${data.percent}%)`;
          openModal();
          break;
        }

        case 'downloaded': {
          if (data.installOnQuit) {
            showUpdate('‚úÖ', 'Update Ready', `v${data.version} will be installed the next time you launch Elite Explorer.`, data.channel);
            setTimeout(closeModal, 5000);
          } else {
            showUpdate('‚úÖ', `v${data.version} Ready to Install`,
              'Download complete. Restart now to apply the update.', data.channel);
            umActions.appendChild(makeBtn('‚ö°  Restart and install', 'primary', () => {
              window.electronAPI.installAndRestart();
            }));
            umActions.appendChild(makeBtn('Later', 'ghost', closeModal));
          }
          break;
        }

        case 'error': {
          let rawMsg = data.message || '';

          // Sanitise the message ‚Äî electron-updater can dump raw XML feed content,
          // full HTTP headers, or multi-line stack traces into the error message.
          // Extract only the first readable sentence before any newline or markup.
          let errMsg = rawMsg
            .split(/
?
/)[0]
            .replace(/<[^>]*>/g, '')
            .replace(/,?\s*XML:.*$/s, '')
            .replace(/,?\s*Headers:.*$/s, '')
            .trim();

          // If what remains is empty, too long, or contains raw markup, use a
          // clean generic message instead.
          if (
            !errMsg ||
            errMsg.length > 120 ||
            errMsg.includes('<?xml') ||
            errMsg.includes('<feed') ||
            errMsg.includes('HttpError') ||
            errMsg.toLowerCase().includes('unable to find latest')
          ) {
            errMsg = 'Could not reach the update server. Check your internet connection or try again later.';
          }

          showUpdate('‚ö†Ô∏è', 'Update Error', errMsg, data.channel || 'stable');
          umActions.appendChild(makeBtn('Retry', 'secondary', () => {
            closeModal();
            window.electronAPI.checkForUpdates();
          }));
          setTimeout(closeModal, 10000);
          break;
        }

        // 'checking' and 'not-available' are intentionally silent
      }
    });
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // PREFERENCES MODAL
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const prefsOverlay   = document.getElementById('prefs-overlay');
  const prefsModal     = document.getElementById('prefs-modal');
  const prefsClose     = document.getElementById('prefs-close');
  const prefsDone      = document.getElementById('prefs-done');
  const prefsCheckNow  = document.getElementById('prefs-check-now');
  const prefsStatus    = document.getElementById('pref-channel-status');
  const radioStable    = document.getElementById('pref-ch-stable');
  const radioBeta      = document.getElementById('pref-ch-beta');
  const labelStable    = document.getElementById('pref-ch-stable-label');
  const labelBeta      = document.getElementById('pref-ch-beta-label');
  const prefsLogStatus  = document.getElementById('prefs-log-status');
  const prefsSaveLog    = document.getElementById('prefs-save-log');
  const prefsViewLog    = document.getElementById('prefs-view-log');
  const prefsLogPreview = document.getElementById('prefs-log-preview');

  let logPreviewVisible = false;

  function highlightSelected() {
    labelStable.style.borderColor = radioBeta.checked ? '#1e3f6a' : '#7eb8f7';
    labelBeta.style.borderColor   = radioBeta.checked ? '#f0a030' : '#1e3f6a';
  }

  function openPreferences() {
    // Show the modal immediately ‚Äî don't await anything first
    prefsStatus.textContent    = '';
    prefsOverlay.style.display = 'block';
    prefsModal.style.display   = 'block';

    // Load update channel asynchronously after modal is visible
    if (window.electronAPI && window.electronAPI.getUpdateChannel) {
      window.electronAPI.getUpdateChannel().then(function(ch) {
        radioStable.checked = (ch !== 'beta');
        radioBeta.checked   = (ch === 'beta');
        highlightSelected();
      }).catch(function() {});
    }
  }

  function closePreferences() {
    prefsOverlay.style.display  = 'none';
    prefsModal.style.display    = 'none';
    prefsLogPreview.style.display = 'none';
    prefsViewLog.textContent    = 'üîç Preview Log';
    logPreviewVisible           = false;
    prefsLogStatus.textContent  = '';
    prefsLogStatus.style.color  = '';
  }

  // ‚îÄ‚îÄ Close triggers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  prefsClose.addEventListener('click', closePreferences);
  prefsDone.addEventListener('click', closePreferences);
  prefsOverlay.addEventListener('click', closePreferences);

  // ‚îÄ‚îÄ Update channel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  radioStable.addEventListener('change', highlightSelected);
  radioBeta.addEventListener('change', highlightSelected);

  [radioStable, radioBeta].forEach(function(r) {
    r.addEventListener('change', function() {
      if (!window.electronAPI || !window.electronAPI.setUpdateChannel) return;
      var ch = r.value;
      prefsStatus.textContent = 'Saving‚Ä¶';
      window.electronAPI.setUpdateChannel(ch).then(function() {
        prefsStatus.textContent = '‚úì Switched to ' + (ch === 'beta' ? 'Alpha / Beta' : 'Stable') + ' channel. Checking for updates‚Ä¶';
        setTimeout(function() { prefsStatus.textContent = ''; }, 4000);
      }).catch(function() {
        prefsStatus.textContent = 'Error saving channel.';
      });
    });
  });

  prefsCheckNow.addEventListener('click', function() {
    if (!window.electronAPI || !window.electronAPI.checkForUpdates) return;
    prefsStatus.textContent = 'Checking for updates‚Ä¶';
    window.electronAPI.checkForUpdates().then(function() {
      setTimeout(function() { prefsStatus.textContent = ''; }, 3000);
    }).catch(function() {
      prefsStatus.textContent = 'Update check failed.';
    });
  });

  // ‚îÄ‚îÄ Debug log ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  prefsSaveLog.addEventListener('click', function() {
    if (!window.electronAPI || !window.electronAPI.saveDebugLog) return;
    prefsLogStatus.style.color  = '';
    prefsLogStatus.textContent  = 'Saving‚Ä¶';
    window.electronAPI.saveDebugLog().then(function(result) {
      if (result && result.success) {
        prefsLogStatus.style.color = '#4caf82';
        prefsLogStatus.textContent = '‚úì Log saved to ' + result.filePath;
      } else if (result && result.canceled) {
        prefsLogStatus.textContent = '';
      } else {
        prefsLogStatus.style.color = '#f05050';
        prefsLogStatus.textContent = 'Error: ' + ((result && result.error) || 'Unknown error');
      }
      setTimeout(function() { prefsLogStatus.textContent = ''; prefsLogStatus.style.color = ''; }, 6000);
    }).catch(function(e) {
      prefsLogStatus.style.color = '#f05050';
      prefsLogStatus.textContent = 'Error: ' + e.message;
    });
  });

  prefsViewLog.addEventListener('click', function() {
    if (!window.electronAPI || !window.electronAPI.getDebugLog) return;
    if (logPreviewVisible) {
      prefsLogPreview.style.display = 'none';
      prefsViewLog.textContent      = 'üîç Preview Log';
      logPreviewVisible             = false;
      return;
    }
    window.electronAPI.getDebugLog().then(function(content) {
      prefsLogPreview.textContent   = content;
      prefsLogPreview.style.display = 'block';
      prefsLogPreview.scrollTop     = prefsLogPreview.scrollHeight;
      prefsViewLog.textContent      = 'üôà Hide Preview';
      logPreviewVisible             = true;
    }).catch(function(e) {
      prefsLogStatus.style.color = '#f05050';
      prefsLogStatus.textContent = 'Error fetching log: ' + e.message;
    });
  });

  // ‚îÄ‚îÄ IPC triggers from the application menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Same-page trigger: user clicks File > Preferences while already on this page
  if (window.electronAPI && window.electronAPI.onOpenPreferences) {
    window.electronAPI.onOpenPreferences(openPreferences);
  }

  // Cross-page trigger: user clicked File > Preferences from a different page,
  // main.js navigated here and set a flag ‚Äî we consume it now that we're ready.
  if (window.electronAPI && window.electronAPI.checkPendingPreferences) {
    window.electronAPI.checkPendingPreferences().then(function(pending) {
      if (pending) openPreferences();
    }).catch(function() {});
  }

})();
</script>
</body>
</html>